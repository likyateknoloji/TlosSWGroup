<?xml version="1.0" encoding="UTF-8"?>

<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://java.sun.com/jsf/html" xmlns:f="http://java.sun.com/jsf/core" xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui">
	<style>
.failed {
	color: red;
	background-color: black;
	font-weight: bold;
}
</style>
	<h:form id="liveForm">
		<p:growl id="messages" showDetail="true" sticky="false" />

		<br></br>

		<p:fieldset id="scenarioManagement" legend="#{msgs['tlos.live.pannel.scenario.header']} - #{scenarioMBean.spcInfoTypeClient.jsName}" style="width: 96%;">

			<p:panel>
				<h:panelGrid columns="5" id="editTable">
					<p:commandButton id="stopScenarioNormalButton" value="#{msgs['tlos.live.pannel.scenario.stopnormal']}" rendered="#{scenarioMBean.spcInfoTypeClient.stopable and security.StopScenarioNormally}"
						actionListener="#{scenarioMBean.stopScenarioNormalAction}" onclick="if(!confirm('#{msgs['tlos.confirm.live.scenario.stop.normal']}')) return false;" />

					<p:commandButton id="stopScenarioForcedButton" value="#{msgs['tlos.live.pannel.scenario.stopforced']}" rendered="#{scenarioMBean.spcInfoTypeClient.stopable and security.StopScenarioForced}"
						actionListener="#{scenarioMBean.stopScenarioForcedAction}" onclick="if(!confirm('#{msgs['tlos.confirm.live.scenario.stop.force']}')) return false;" />

					<p:commandButton id="pauseScenarioButton" value="#{msgs['tlos.live.pannel.scenario.pause']}" rendered="#{scenarioMBean.spcInfoTypeClient.pausable and security.PauseScenario}"
						actionListener="#{scenarioMBean.pauseScenarioAction}" onclick="if(!confirm('#{msgs['tlos.confirm.live.scenario.pause']}')) return false;" />

					<p:commandButton id="resumeScenarioButton" value="#{msgs['tlos.live.pannel.scenario.resume']}" rendered="#{scenarioMBean.spcInfoTypeClient.resumable and security.ResumeScenario}"
						actionListener="#{scenarioMBean.resumeScenarioAction}" onclick="if(!confirm('#{msgs['tlos.confirm.live.scenario.resume']}')) return false;" />

					<p:commandButton id="startScenarioButton" value="#{msgs['tlos.live.pannel.scenario.start']}" rendered="#{scenarioMBean.spcInfoTypeClient.startable and security.StartScenario}"
						actionListener="#{scenarioMBean.startScenarioAction}" onclick="if(!confirm('#{msgs['tlos.confirm.live.scenario.start']}')) return false;" />

					<p:commandButton id="viewScenarioTree" value="#{msgs['tlos.main.navigation.panel.viewScenarioTree']}" action="#{liveMBean.viewScenarioTree}" />

				</h:panelGrid>
			</p:panel>

			<br />

			<p:dataTable id="jobListDataTable" var="item" value="#{scenarioMBean.jobInfoList}" rowStyleClass="#{item.liveStateInfo.statusName eq 'FAILED' ? 'failed' : null}" widgetVar="itemsTable"
				resizableColumns="true" binding="#{scenarioMBean.jobDataTable}" filteredValue="#{scenarioMBean.filteredJobs}" emptyMessage="No records found with given criteria" sortMode="multiple" width="100%"
				paginator="true" rows="10" paginatorPosition="bottom" paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
				rowsPerPageTemplate="5,10,15">

				<f:facet name="header">
					<p:outputPanel>
						<h:outputText value="Search all fields:" />
						<p:inputText id="globalFilter" onkeyup="itemsTable.filter()" style="width:150px" />
					</p:outputPanel>
				</f:facet>

				<p:column headerText="#{msgs['tlos.live.pannel.job.jobName']}" sortBy="#{item.jobName}" filterBy="#{item.jobName}" filterMatchMode="contains">
					<h:outputText value="#{item.jobName}" style="text-align: center;" />
				</p:column>

				<p:column headerText="#{msgs['tlos.live.pannel.job.stateInfo']}" sortBy="#{item.liveStateInfo.stateName}" filterBy="#{item.liveStateInfo.stateName}" filterMatchMode="contains">
					<h:outputText value="#{item.liveStateInfo.stateName}" style="text-align: center;" />
				</p:column>

				<p:column headerText="#{msgs['tlos.live.pannel.job.subState']}" sortBy="#{item.liveStateInfo.substateName}" filterBy="#{item.liveStateInfo.substateName}" filterMatchMode="contains">
					<h:outputText value="#{item.liveStateInfo.substateName}" style="text-align: center;" />
				</p:column>

				<p:column headerText="#{msgs['tlos.live.pannel.job.status']}" sortBy="#{item.liveStateInfo.statusName}" filterBy="#{item.liveStateInfo.statusName}" filterMatchMode="contains">
					<h:outputText value="#{item.liveStateInfo.statusName}" style="text-align: center;" />
				</p:column>


				<p:column headerText="#{msgs['tlos.live.pannel.job.plannedTime']}" sortBy="#{item.jobPlanTime}" filterBy="#{item.jobPlanTime}" filterMatchMode="contains">
					<h:outputText value="#{item.jobPlanTime}" style="text-align: center;" />
				</p:column>

				<p:column headerText="#{msgs['tlos.live.pannel.job.execution']}" sortBy="#{item.plannedExecutionDate}" filterBy="#{item.plannedExecutionDate}" filterMatchMode="contains">
					<h:outputText value="#{item.plannedExecutionDate}" style="text-align: center;" />
				</p:column>

				<p:column headerText="#{msgs['tlos.live.pannel.job.duration']}" sortBy="#{item.workDuration}" filterBy="#{item.workDuration}" filterMatchMode="contains">
					<h:outputText value="#{item.workDuration}" style="text-align: center;" />
				</p:column>

				<p:column headerText="#{msgs['tlos.workspace.pannel.job.oSystem']}" sortBy="#{item.oSystem}" filterOptions="#{scenarioMBean.osSelectItem}" filterMatchMode="exact">
					<h:outputText value="#{item.oSystem}" style="text-align: center;" />
				</p:column>

				<p:column>
					<f:facet name="header">
						<h:outputText value="#{msgs['tlos.live.pannel.job.agent']}" />
					</f:facet>
					<h:outputText value="-" rendered="#{item.resourceName eq null}" />
					<h:outputText value="#{item.resourceName}.#{item.agentId}" rendered="#{item.resourceName ne null}" />
				</p:column>

				<p:column>
					<f:facet name="header">
						<h:outputText value="#{msgs['tlos.live.pannel.scenario.manage']}" />
					</f:facet>

					<p:commandButton id="retryJobButton" value="#{msgs['tlos.button.retry']}" rendered="#{item.retriable and security.RetryJob}" actionListener="#{scenarioMBean.retryJobAction}" />

					<p:commandButton id="doSuccessJobButton" value="#{msgs['tlos.button.setSuccess']}" rendered="#{item.successable and security.SetSuccessJob}" actionListener="#{scenarioMBean.doSuccessJobAction}" />

					<p:commandButton id="skipJobButton" value="#{msgs['tlos.button.skip']}" rendered="#{item.skippable and security.SkipJob}" actionListener="#{scenarioMBean.skipJobAction}" />

					<p:commandButton id="stopJobButton" value="#{msgs['tlos.button.stop']}" rendered="#{item.stopable and security.StopJob}" actionListener="#{scenarioMBean.stopJobAction}" />

					<p:commandButton id="pauseJobButton" value="#{msgs['tlos.button.pause']}"
						rendered="#{item.pausable and security.PauseJob and item.liveStateInfo.statusName ne 'USER-WAITING' and item.liveStateInfo.statusName ne 'USER-CHOOSE-RESOURCE'}"
						actionListener="#{scenarioMBean.pauseJobAction}" />

					<p:commandButton id="resumeJobButton" value="#{msgs['tlos.button.resume']}" rendered="#{item.resumable and security.ResumeJob}" actionListener="#{scenarioMBean.resumeJobAction}" />

					<p:commandButton id="startJobButton" value="#{msgs['tlos.button.start']}" rendered="#{item.startable and security.StartJob}" actionListener="#{scenarioMBean.startJobAction}" />

					<p:commandButton id="startUserBasedJobButton" value="#{msgs['tlos.button.start']}" rendered="#{item.liveStateInfo.statusName eq 'USER-WAITING' and security.StartUserBasedJob}"
						actionListener="#{scenarioMBean.startUserBasedJobAction}" />

					<p:commandButton id="selectResourceButton" value="#{msgs['tlos.button.showAvailableResources']}"
						rendered="#{item.liveStateInfo.statusName eq 'USER-CHOOSE-RESOURCE' and security.ShowAvailableResourcesForJob}" actionListener="#{scenarioMBean.showAvailableResourcesForJob}"
						update=":liveForm:agentSelectionPanel" oncomplete="agentSelectionDialog.show()" />
				</p:column>

			</p:dataTable>

			<p:dialog id="agentSelectionDialog" header="#{msgs['tlos.live.pannel.job.selectAgentPanel']}" widgetVar="agentSelectionDialog" resizable="false" showEffect="show">
				<p:panel id="agentSelectionPanel">
					<h:panelGrid columns="2">
						<p:selectOneMenu rendered="#{scenarioMBean.resourceListForJob ne null}" id="resourceList" value="#{scenarioMBean.selectedResource}">
							<f:selectItem itemLabel="#{msgs['tlos.combo.select']}" itemValue="" />
							<f:selectItems value="#{scenarioMBean.resourceListForJob}" />
							<p:ajax partialSubmit="true" update="agentSelectionPanel"></p:ajax>
						</p:selectOneMenu>

						<p:commandButton id="assignResource" value="#{msgs['tlos.button.ok']}" rendered="#{scenarioMBean.selectedResource ne null and scenarioMBean.selectedResource ne ''}"
							actionListener="#{scenarioMBean.assignAgentForJob}" />
					</h:panelGrid>
				</p:panel>
			</p:dialog>

		</p:fieldset>

	</h:form>

</ui:composition>